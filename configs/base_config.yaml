pipeline:
  name: "semiff_pilot"
  workspace: "outputs/auto" # è‡ªåŠ¨ç”Ÿæˆå¸¦æ—¶é—´æˆ³çš„è¾“å‡ºç›®å½•
  # "new" = æ¯æ¬¡éƒ½è·‘æ–°çš„; "resume" = æ¥ç€ä¸Šæ¬¡æœ€æ–°çš„è·‘
  mode: "new"
  device: "cuda"

  # ==============================
  # ğŸ•¹ï¸ æ­¥éª¤å¼€å…³ (æ–°å¢)
  # ==============================
  steps:
    step1:
      enable_sam2: false   # âŒ å…³é—­ SAM 2
      enable_sam3: true    # âœ… å¼€å¯ SAM 3
      enable_mast3r: true
      rotate_code: null

  # ğŸ¯ SAM 3 é…ç½® (æ–°å¢)
  sam3:
    checkpoint: "checkpoints/sam3"  # æŒ‡å‘ç›®å½•è€Œä¸æ˜¯ .pt æ–‡ä»¶
    # ğŸ’¡ å…³é”®ï¼šé€šè¿‡ç»„åˆè¯è§£å†³æ¼é€‰é—®é¢˜
    prompts_robot:  # ID 2
      - "white robotic arm"   # å¢åŠ é¢œè‰²é™å®š
      - "xarm6 robot arm"        # å¦‚æœæ˜¯ UR æœºæ¢°è‡‚ï¼Œç›´æ¥åŠ å“ç‰Œåæœ‰æ—¶æ›´å‡†
      # - "robot base"        # å»ºè®®åˆ é™¤ï¼Œå¤ªå®¹æ˜“è¯¯æ£€èƒŒæ™¯æ‚ç‰©
      - "robot claw"          # gripper æ”¹æˆ claw è¯•è¯•ï¼Œæˆ–è€… hand

    prompts_object: # ID 1
      - "white T-shaped block" # æè¿°å½¢çŠ¶
    box_threshold: 0.25
    text_threshold: 0.2

  # (æ—§çš„ sam2 é…ç½®å¯ä¿ç•™ä»¥å¤‡å›æ»š)
  sam2:
    checkpoint: "checkpoints/sam2_hiera_large.pt"
    model_cfg: "configs/sam2.1/sam2.1_hiera_l.yaml"

  # âš ï¸ å¼ºåˆ¶å…³é—­äº¤äº’æ¨¡å¼ï¼Œç¡®ä¿å…¨è‡ªåŠ¨
  interactive_mode: false

data:
  dataset_name: "example_01"
  # æ•°æ®æ ¹ç›®å½•ï¼Œæ ¹æ®ä½ çš„å®é™…æƒ…å†µä¿®æ”¹
  root_dir: "data/example_01"
  # è§†é¢‘æ–‡ä»¶ (ç›¸å¯¹äº root_dir)
  video_path: "video.mp4"
  # å…³èŠ‚é…ç½®æ–‡ä»¶ (ç›¸å¯¹äº root_dir)
  robot_config: "config/align_pose.json"

robot:
  # URDF è·¯å¾„ (ç›¸å¯¹äº root_dir)
  urdf_rel_path: "robot/xarm6_with_gripper_v1.urdf"
  base_link_name: "link_base"

training_3dgs:
  mock: True # å¦‚æœæ²¡å®‰è£… nerfstudioï¼Œè®¾ä¸º True ä»¥è·³è¿‡è®­ç»ƒ
  iterations: 1000
  cull_alpha_thresh: 0.005

optimization:
  lr_pose: 0.002
  lr_trans: 0.01
  lr_scale: 0.005
  iterations: 200

alignment:
  loss_type: "soft_iou" # choices: [soft_iou, mse]
  iou_smooth: 1.0e-6
  # åˆå§‹çŒœæµ‹ (x, y, z)ï¼Œå¾ˆé‡è¦ï¼Œé˜²æ­¢é™·å…¥å±€éƒ¨æœ€ä¼˜
  init_trans: [0.0, 0.0, 1.2]

geometry:
  binding_method: "adaptive" # choices: [adaptive, fixed]
  # è·ç¦»åˆ†å¸ƒçš„ç™¾åˆ†ä½é˜ˆå€¼ (ä¾‹å¦‚ 90%)
  adaptive_percentile: 90.0
  # å¼ºåˆ¶æœ€å¤§é˜ˆå€¼ (ç±³)ï¼Œé˜²æ­¢æŠŠèƒŒæ™¯è¯¯åˆ¤ä¸ºæœºå™¨äºº
  max_threshold: 0.05

# ==============================
# ğŸ›ï¸ æ ‡å®šä¸ä¼˜åŒ–é…ç½® (Calibration)
# ==============================
calibration:
  # --- Phase 1: 3D ç²—é…å‡† (RANSAC) ---
  coarse:
    enable: true                # æ˜¯å¦æ‰§è¡Œç²—é…å‡†
    type: "ransac_3d"           # ç®—æ³•ç±»å‹
    num_samples_physical: 5000  # åœ¨ URDF ä¸Šé‡‡æ ·çš„ç‚¹æ•°
    ransac_threshold: 0.05      # RANSAC è·ç¦»é˜ˆå€¼ (ç±³)ï¼Œè¶Šå°è¶Šä¸¥æ ¼
    visual_filter:
      enable: true              # æ˜¯å¦ä½¿ç”¨ Step1 çš„ Mask è¿‡æ»¤èƒŒæ™¯å™ªå£°
      vote_threshold: 0.3       # è‡³å°‘åœ¨ 30% çš„å¸§ä¸­è½åœ¨ Mask å†…æ‰ä¿ç•™ç‚¹

  # --- Phase 2: 2D ç²¾é…å‡† (Differentiable Rendering) ---
  # --- Phase 3: 3D Chamfer Distance ä¼˜åŒ– (å¯é€‰) ---
  fine:
    enable: true
    use_chamfer: true          # å¦‚æœä¸º trueï¼Œä½¿ç”¨ Chamfer Distance æ¨¡å¼ï¼›å¦åˆ™ä½¿ç”¨æ¸²æŸ“æ¨¡å¼
    use_chain_growth: true     # å¦‚æœä¸º trueï¼Œä½¿ç”¨é“¾å¼ç”Ÿé•¿ä¼˜åŒ–ï¼ˆæ¨èï¼Œè§£å†³å…³èŠ‚è€¦åˆé—®é¢˜ï¼‰
    renderer: "nvdiffrast"      # backend (ä»…ç”¨äºæ¸²æŸ“æ¨¡å¼)
    iterations: 200
    batch_size: 8               # æ˜¾å­˜å¤Ÿå¤§å¯è°ƒå¤§ï¼Œå¢åŠ æ¢¯åº¦ç¨³å®šæ€§ (ä»…ç”¨äºæ¸²æŸ“æ¨¡å¼)
    image_size: [512, 512]      # æ¸²æŸ“åˆ†è¾¨ç‡ (H, W)ï¼Œé™ä½åˆ†è¾¨ç‡å¯åŠ é€Ÿ (ä»…ç”¨äºæ¸²æŸ“æ¨¡å¼)
    joint_reg_weight: 1.0       # å…³èŠ‚è§’åº¦æ­£åˆ™åŒ–æƒé‡ (ä»…ç”¨äº Chamfer æ¨¡å¼)

    # å­¦ä¹ ç‡é…ç½®
    lr:
      base_scale: 0.01
      base_rot: 0.01
      base_trans: 0.05          # åŠ å¤§å¹³ç§»å­¦ä¹ ç‡ï¼Œå¸®åŠ©å¿«é€Ÿå¯¹é½ä½ç½®
      joint_delta: 0.0           # â›”ï¸ ç¬¬ä¸€é˜¶æ®µï¼šæš‚æ—¶é”æ­»å…³èŠ‚ï¼é˜²æ­¢å˜æˆéº»èŠ±
                                  # å¦‚æœå¤–å‚å·²ç»å¯¹é½ï¼Œç¬¬äºŒé˜¶æ®µå¯ä»¥è®¾ä¸º 0.01 è¿›è¡Œå…³èŠ‚å¾®è°ƒ
      decay_step: 50            # æ¯å¤šå°‘æ­¥è¡°å‡ä¸€æ¬¡
      decay_gamma: 0.5          # è¡°å‡ç³»æ•°

    # æŸå¤±å‡½æ•°
    loss:
      type: "iou"               # é€‰é¡¹: "iou", "mse" (ä»…ç”¨äºæ¸²æŸ“æ¨¡å¼)
      smooth: 1.0e-6

  # --- åˆå§‹çŒœæµ‹ (å½“ Coarse å…³é—­æ—¶ä½¿ç”¨) ---
  # âš ï¸ é‡è¦ï¼šå¦‚æœä¼˜åŒ–å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨è°ƒæ•´è¿™äº›å€¼ï¼
  # æ–¹æ³•ï¼šè¿è¡Œä¸€æ¬¡ä¼˜åŒ–ï¼ŒæŸ¥çœ‹ debug_mast3r_aligned_to_base.ply å’Œ debug_robot_in_base_frame.ply
  # å¦‚æœä¸¤ä¸ªç‚¹äº‘ç›¸è·å¾ˆè¿œï¼Œæ‰‹åŠ¨è°ƒæ•´ translate å’Œ scaleï¼Œè®©å®ƒä»¬å¤§è‡´å¯¹é½
  initial_guess:
    scale: 1.0
    translate: [0.0, 0.0, 0.0]  # æ‰‹åŠ¨è°ƒæ•´è¿™ä¸ªï¼æ‰“å¼€ debug_obs.ply çœ‹çœ‹ç‚¹äº‘ä¸­å¿ƒåœ¨å“ªé‡Œ
    # å¦‚æœç‚¹äº‘ä¸­å¿ƒåœ¨ (10, 10, 10)ï¼Œè¿™é‡Œå°±å¡« [10, 10, 10]
